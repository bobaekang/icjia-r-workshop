---
title: "R Workshop: Module 2 (2)"
author: "Bobae Kang"
date: "January 31, 2018"
output:
  html_document:
    self_contained: no
    toc: TRUE
    toc_float	:	TRUE
    toc_depth: 2
    includes:
      after_body: ../include_footer.html
css: ../css/style.css
---
<!-- fontawesome CDN -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<!-- logo -->
<div class="logo">
  <a href="http://www.icjia.state.il.us/"><img src="../images/icjia.png" alt="ICJIA logo"></img></a>
</div>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This page contains the notes for **the second part of R Workshop Module 2: R basics**, which is part of the R Workshop series prepared by ICJIA Research Analyst [Bobae Kang](http://www.icjia.state.il.us/biographies/bobae-kang) to enable and encourage ICJIA researchers to take advantage of R, a statistical programming language that is one of the most powerful modern research tools.

### Links
Click [**here**](../index.html) to go to the workshop **home page**.

Click [**here**](../modules.html) to go to the workshop **Modules page**.

Click [**here**](../slides/module2_slides2.html) to view the accompanying **slides for Module 2, Part 2**.

Navigate to the other workshop materials:

* **Module 1: Introduction to R** ([**slides**](../slides/module1_slides.html),
[**note**](module1_notes.html))
* **Module 2: R basics**
    * Part 1 ([**slides**](../slides/module2_slides1.html), [**note**](module2_notes1.html))
* **Module 3: Data analysis with R**
    * Part 1 ([**slides**](../slides/module3_slides1.html), [**note**](module3_notes1.html))
    * Part 2 ([**slides**](../slides/module3_slides2.html), [**note**](module3_notes2.html))
* **Module 4: Data visualization with R**
    * Part 1 ([**slides**](../slides/module4_slides1.html), [**note**](module4_notes1.html))
    * Part 2 ([**slides**](../slides/module4_slides2.html), [**note**](module4_notes2.html))
* **Module 5: Statistical modeling with R**
    * Part 1 ([**slides**](../slides/module5_slides1.html), [**note**](module5_notes1.html))
    * Part 2 ([**slides**](../slides/module5_slides2.html), [**note**](module5_notes2.html))
* **Module 6: Sharing your analysis and more**
    * Part 1 ([**slides**](../slides/module6_slides1.html), [**note**](module6_notes1.html))
    * Part 2 ([**slides**](../slides/module6_slides2.html), [**note**](module6_notes2.html))


***

# R Basics (2): Gearing up for data analysis in R

***

# R Data Frame

```{r echo=FALSE}
print("Look, a data frame!")
data.frame(
  column1 = seq(1,5)*10 + 1,
  column2 = seq(1,5)*10 + 2,
  column3 = seq(1,5)*10 + 3,
  column4 = seq(1,5)*10 + 4,
  column5 = seq(1,5)*10 + 5
)
```

## What is a data frame?

* A tabular representation of data where each column is a vector of some type.
    * think of Excel spreadsheets, SPSS tables, etc.!
* Can be seen as a *list of vectors* of *the same length*, but with additional functionalities for data analysis!
    * accessing data in a data frame works similarly
    * a list can be easily converted into a data frame using `as.data.frame()` (... and vice versa, with `as.list()`)


## Example: Iris data 

R comes with a data frame of [the (famous) Iris flower dataset](https://en.wikipedia.org/wiki/Iris_flower_data_set). Let's take a look:

```{r}
class(iris)  # the class of iris object is "data.frame"
is.data.frame(iris)  # check if iris is a data.frame; TRUE, as expected
```

```{r}
str(iris)  # reports the "structure" of the data frame 
head(iris, 5)  # returns the first n rows of the data frame (default 6)
```


```{r}
dim(iris)  # returns the dimension of the data frame (row  column)
nrow(iris)  # returns the number of rows in the data frame
ncol(iris)  # returns the number of columns in the data frame
colnames(iris)  # returns a vector containing the column names 
```


```{r eval=FALSE}
iris$Sepal.Length  # access a column by name
iris[[1]]          # access the first column by index
iris[, 1]          # yet another way to access the first column!
```
```{r echo=FALSE}
iris$Sepal.Length
```
```{r}
iris[1, ]  # access the first row by index
iris[1, 1]  # access a specific cell (first row of the first column)
```

## Creating a data frame

* Using `data.frame()`
    * Using existing vectors as arguments
    * Simultanesouly creating vectors and assigning column names to them  
* Coercing a list using `as.data.frame()`


### Using data.frame()

1. Using existing vectors

```{r}
fruits <- c("apple", "banana", "clementine")
animals <- c("dogs", "cats", "llamas")
icecream_flavors <- c("chocolate", "vanila", "cookie dough")

df1 <- data.frame(fruits, animals, icecream_flavors)

print(df1)
```

2. Simultaneously creating vectors and assigning names

```{r}
df2 <- data.frame(
  fruits = c("apple", "banana", "clementine"),
  animals = c("dogs", "cats", "llamas"),
  icecream_flavors = c("chocolate", "vanila", "cookie dough")
)

print(df2)
```

### Converting a list using as.data.frame()

```{r}
lt <- list(
  fruits = c("apple", "banana", "clementine"),
  animals = c("dogs", "cats", "llamas"),
  icecream_flavors = c("chocolate", "vanila", "cookie dough")
)

df3 <- as.data.frame(lt)

print(df3)
```

## Transforming a data frame

* change column names
* add / modify / remove columns
* add / modify / remove rows
* modify cell values

### Change column names

```{r}
colnames(df1) <- c("my_fruits", "my_animals", "my_flavors")

print(df1)
```

### Add columns

```{r}
# using $ index
df1$my_colors <- c("red", "green", "orange")

# using cbind() function
my_cities <- c("Chicago", "New Work", "Los Angeles")
df1 <- cbind(df1, my_cities)

print(df1)
```

### Modify columns

```{r}
df1[["my_colors"]] <- c("maroon", "blue", "purple")
df1$my_cities <- c("Chicago", "London", "Paris")

df1
```

### Remove columns

```{r}
# assinging NULL
df1$my_colors <- NULL

df1

# subsetting
df1 <- df1[, 1:3]  # or c("my_fruits", "my_animals", "my_flavors")

df1
```

### Add rows

```{r}
new_row <- data.frame(
  my_fruits = "strawberry",
  my_animals = "monkeys",
  my_flavors = "butter pecan"
)
df1 <- rbind(df1, new_row)

df1
```

### Remove rows

```{r}
# subsetting
df1 <- df1[1:3, ]

df1
```

### Modify cells
```{r}
# this doesn't work ... why?
df1$my_flavors[1] <- "mint chocolate chip"

df1

# because the column is a factor and only
# new values of the existing levels can be added
df1$my_flavors
```

```{r}
# first we coerce the column into character class
df1$my_flavors <- as.character(df1$my_flavors)

# now works!
df1$my_flavors[1] <- "mint chocolate chip"

df1

```

## Extending data frame

* In practice, R's original `data.frame` is rarely used since better alternatives are available.
    * `tibble`
    * `data.table`
* Both alternatives are extension of the original `data.frame`
    * either can be manipulated just like a data frame


### `tibble`
```{r echo=FALSE}
tibble::tibble(
  column1 = seq(1,5)*10 + 1,
  column2 = seq(1,5)*10 + 2,
  column3 = seq(1,5)*10 + 3,
  column4 = seq(1,5)*10 + 4,
  column5 = seq(1,5)*10 + 5
)
```

* Part of the `tidyverse` framework (we'll come back to this)
* More easily understood `tidyverse` syntax
* Refined print method
* Coercing a data frame into a tibble can be done with `as_tibble()` from `tibble` package 
* See [here](http://r4ds.had.co.nz/tibbles.html) for more on tibble

### `data.table`

```{r echo=FALSE}
data.table::data.table(
  column1 = seq(1,5)*10 + 1,
  column2 = seq(1,5)*10 + 2,
  column3 = seq(1,5)*10 + 3,
  column4 = seq(1,5)*10 + 4,
  column5 = seq(1,5)*10 + 5
)
```
* Made available via `data.frame` package.
* Highly optimized for larger tables (e.g. >100K rows).
* Compact syntax for advanced slicing and dicing of tablular data.
* Coercing a data frame into a data table can be done with `as.data.table()` 
* See [here](https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html) for more on data.table

***

# R Add-On Packages
```{r echo=FALSE, out.width="45%", out.extra='style="display: block; margin: auto; box-shadow: none;"'}
knitr::include_graphics("https://s3.amazonaws.com/assets.datacamp.com/blog_assets/R+Packages+Guide/content_rdoc10.png")
```
<div style="font-size:0.5em; text-align:center; color: #777;">
Source: <a href="https://www.datacamp.com/">DataCamp</a>
</div>

## What are add-on packages?

> The capabilities of R are extended through user-created packages, which allow specialized statistical techniques, graphical devices, import/export capabilities, reporting tools [...], etc. - "R (programming language)", Wikipedia

## Using packages

```{r eval=FALSE}
# first we should install the desired package
install.packages("some_package")

# then we import the package to use its functionalities
library(some_package)
```

## Two ways of installing packages

* From CRAN (Comprehensive R Archive Network)
    * tested and trusted
    * using `install.packages("package")`
* From specific Github repositories (i.e., development versions)
    * latest versions with cutting-edge features 
    * using `install_github("author/package")`
        * `install_github()` is available via `devtools` package.

* Also, check out "Install Packages" [tutorial video](https://vimeo.com/203516241) by RStudio, Inc.

***

# Tidyverse Framework

```{r echo=FALSE, out.width="100%", out.extra='style="display: block; margin: auto; box-shadow: none;"'}
knitr::include_graphics("../images/tidyverse.png")
```
<div style="font-size:0.5em; text-align:center; color: #777;">
Source: <a href="https://www.tidyverse.org/">tidyverse.org</a>
</div>

## Tidy approach to data science

Tidy data is data where:

> 1. Each variable is in a column
> 2. Each observation is a row
> 3. Each value is a cell.

```{r echo=FALSE, out.width="100%", out.extra='style="display: block; margin: auto; box-shadow: none;"'}
knitr::include_graphics("http://r4ds.had.co.nz/images/tidy-1.png")
```
<div style="font-size:0.5em; text-align:center; color: #777;">
Source: Hadley Wickham, 2017, <a href="http://r4ds.had.co.nz/"><span style="font-style:italic">R for Data Science</span></a>
</div>

* See [here](http://r4ds.had.co.nz/tidy-data.html) for more on tidy data

## Untidy data?

Anything that is not tidy!

* Multiple variables in a single column
* Multiple observations in a single row
* Multiple rows for a single observation
* Multiple values in a single cell
* Multiple cells for a single value

### Untidy example 1

```{r echo=FALSE}
library(dplyr)
iris %>%
  mutate(
    `Sepal.Length/Width` = paste(Sepal.Length, "/", Sepal.Width, sep = ""),
    `Petal.Length/Width` = paste(Petal.Length, "/", Petal.Width, sep = "")
  ) %>%
  select(`Sepal.Length/Width`, `Petal.Length/Width`, Species) %>%
  head()
```

### Untidy example 2

```{r echo=FALSE}
library(tidyr)
iris2 <- iris
iris$index <- as.numeric(row.names(iris))
iris %>%
  gather(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, key = "type", value = "value") %>%
  select(index, type, value, Species) %>%
  arrange(index) %>%
  head(10)
  
```

## Tidyverse core packages

* `ggplot2` for data visualization
* `dplyr` for data manipulation
* `tidyr` for creating "tidy data"
* `readr` for data import/export
* `purrr` for loop operations
* `tibble` for data representation

## Resources

* RStudio, Inc., "tidy tutorial" [video](https://vimeo.com/211352331)

***

# Good Code, Bad Code

```{r echo=FALSE, out.width="60%", out.extra='style="display: block; margin: auto; box-shadow: none;"'}
knitr::include_graphics("https://static01.nyt.com/images/2016/11/27/opinion/RFD-digital-connectedness/RFD-digital-connectedness-sfSpan.jpg")
```
<div style="font-size:0.5em; text-align:center; color: #777;">
Source: <a href="https://www.nytimes.com/">The New York Times</a>
</div>

## Why style guide?

> The goal [of the style guide] is to make our R code easier to read, share, and verify.  - Google's R Style guide

* Readability
* Productivity
* Reproducibility


## Which style guide?

* Currently, there is no single style guide adopted by the R community as *the* standard.
    * [Google's R Style guide](https://google.github.io/styleguide/Rguide.xml)
    * [Tidyverse style guide](http://style.tidyverse.org/)
    
## Personal recommendations

* Start with the tidyverse style guide
* Consider adding extra rules *only if* they will help your team to better collaborate and maintain code
* Keep the changes to minimum so that code remains accessible to others, including future teammates and even your future self!


## Object naming

* Be descriptive yet concise
    * somewhat dependent on the shared knowledge on the subject matter
* Use underscore for names consisting of multiple words
* Nouns for variables, verbs for functions
* Avoid re-using common names for functions and variables
    * Using "reserved words" to assign objects will throw errors

### Naming a variable (e.g. for firearm arrests)

```{r eval=FALSE}
# Good
firearm_arr
fa_arr

# Bad
arrests_with_firearm_charges  # too verbose
firearmArrests                # violating underscore convention
FireArm_Arrests               # mixing underscore with other way of naming
farr                          # not descriptive enough
x                             # not descriptive at all
```

### Naming a function (e.g. for counting arrests)

```{r eval=FALSE}
# Good
count_arr <- function(x) { ... }

# Bad
num_arr <- function(x) { ... }  # noun for a function
do_arr  <- function(x) { ... }  # not descriptive enough
count   <- function(x) { ... }  # too generic (common name)
```

### Reserved words in R

```{r eval=FALSE}
if else repeat while function for  
in next break  # used in loops, conditions, functions

TRUE FALSE  # logical values

NULL  # undefined

Inf  # infinity

NaN  # Not a Number

NA  # not available (missing)

NA_integer_ NA_real_
NA_complex_ NA_character_  # NA for atomic vector types

...  # dot method for one function to pass arguments to another
```

## Whitespaces for readable code

* Add a space
    * around operators (`+`, `-`, `<`, `=`, etc.)
        * Exceptions include `:`, `::`, and `:::`  
    * after a comma (but not before--like in regular English)
    * before a left paranthesis `(`, except when it is a function call
* Extra spacing for alignment of code
* Indentation for clarifying hierarchy

### Adding spaces

```{r eval=FALSE}
# Good
greetings <- paste("Hello", "World!", sep = " ")
df[2, ]
x <- 1:10 
base::Random() # calling a function with specifying the package

# Bad
greetings<-paste("Hello","world!",sep="")
df[ 2,]
x<- 1 : 10
base :: Random ()
```

### Extra spacing

```{r eval=FALSE}
# for aligning function arguments
some_function (
  first_argument   = value_1
  another_argument = value_2
  example          = value_3
)

# for aligning variable assignments
numbers        <- c(1, 2, 3)
roman_numerals <- c("I", "II", "III")
letters        <- c("a", "b", "c")        
```

### Indentation

```{r eval=FALSE}
# Good
if (x > 0) {
  i = 0
  while (i < 10) {
    message("Wait, I'm in a loop")  
    i <- i + 1
  }
  message("x is positive.")
} else {
  message("x is not positive")
}

# Bad
if (y > 0) {
    j = 0
while (j < 10) {
message("Wait, I'm in a loop")  
j <- j + 1
    }
      message("y is positive.")
} else {
message("y is not positive")
}
```

## Comments for intelligible code 

* Use comments (code after the `#` symbol) for clarification
    * add two spaces before starting a comment if the comment comes after an expression
* However, whenever possible, use *descriptive names* to reduce the need for clarification and avoid verbosity!
* Example of unnecesary comment:

```{r eval=FALSE}
# the following code calculates the average of some numbers
numbers <- c(1, 3, 5)  # assign a vector of numbers to numbers object
average <- sum(numbers) / length(numbers)  # divide the sum of numbers vecotr by its length to get the average
```

## Most importantly...

* Be consistent!
* Be concise!
* Be clear!

